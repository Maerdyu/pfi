# java 代码是怎么运行的

## 为什么java要在虚拟机中运行
- 只要安装了jre,就可以在任何地方运行,甚至是网页,不受限制
- Java虚拟机做了内存管理和垃圾回收
- java虚拟机还做了一些校验，数据越界、安全等

## java虚拟机是怎么样运行字节码的
- 首先编译器会吧java文件编译成class
- java虚拟机会把字节码翻译成机器码
- 加载过程？

## java虚拟机的内存分配
- 1.首先将方法加载到方法区
- 2.对象存放堆空间 线程共享的，也是垃圾回收的主战场
- 3.栈,每个方法在执行的线程执行的时候，都会创建一个栈帧,包括本地方法栈和Java栈，还有一个寄存器用于记录方法的执行，线程独享的

## java虚拟机的运行效率
- hotspot虚拟机支持解释执行和即时编译两种方式
- 解释执行就是对方法的每一行解释成机器语言，然后执行
- 即时编译会把一整个方法变成机器语言然后执行，运行速度快， 主要是针对热点代码，还会对代码做各种优化，包括：逃逸分析、 锁消除、 锁膨胀、 方法内联、 空值检查消除、 类型检测消除、 公共子表达式消除
- 对于长循环或者死循环还会对这个循环编译，然后实现栈上替换
- JDK8中即时编译器 JIT 有两种C1 C2,C1常用在客户端，启动速度快，C2常在server端，优化程度高，能长时间保持高效。
- AOT和graal ？

### 字节码asmtools
- [下载](https://github.com/hengyunabc/hengyunabc.github.io/files/2188258/asmtools-7.0.zip)
- [参考](https://www.jianshu.com/p/25dde2c4a8da)


